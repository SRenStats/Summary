#12-20simulation
library(network)
library(ergm)

n<-20
T<-10
k<-3
##########################################################################################
beta0<-c(-2.5,1,0.5)
beta<-rep(beta0,T)
aa<-seq(1, k*T, k)###?????????????????????
beta[aa[1:5]]<--3##????????????

g.use<- network(n,directed=FALSE)##????????????
attr1<-rnorm(n)##???????????????
set.vertex.attribute(g.use, "nodeattr1", attr1)
attr2<-sample((0:1),n,replace=TRUE)##???????????????0/1
set.vertex.attribute(g.use, "nodeattr2", attr2)
g.use

data<-array(dim=c(n,n,T))
for(t in 1:T){
  g.sim <- simulate(g.use~edges+nodecov("nodeattr1")+nodematch("nodeattr2"), nsim=1, coef=beta[(k*t-k+1):(k*t)])
  m<-as.matrix.network(g.sim,matrix.type="adjacency")
  data[,,t]<-m	
}
#####?????????????????????????????????????????????????????????

data1<-array(dim=c(n*(n-1)/2,k+1,T))##?????????
for (t in 1:T)
{
  m<-data[,,t]
  x1<-NULL
  for (i in 1:(n-1))
  {
    for (j in (i+1):n)
    {
      b<-m[i,j]
      a1<-1
      a2<-attr1[i]+attr1[j]
      a3<-ifelse(attr2[i]==attr2[j],1,0)
      a<-c(b,a1,a2,a3)
      x1<-rbind(x1,a)##????????????
    }
  }
  data1[,,t]<-x1  
}


###???????????????????????????
x<-combine(data1)
###??????beta
ep1<-10^(-5)
max<-500



lams<-seq(0,100,5)
rho<-500
ad2<-c()
for (l in 1:length(lams))
{
  ad1<-admm(x,T,k,ep1,max,lams[l],rho)
  ad2<-cbind(ad2,ad1)
}
ad3<-ad2
##????????????rho=1

tt<-c(1:T)
yy<-beta[seq(1, k*T, k)]
plot(tt,yy,type = 'b',col="black",ylab="beta1",ylim=c(-3.5,-1.5))

ki<-4#??????ki?????????(1:3)
for (i in 1:ncol(ad3))
{
  yi<-ad3[seq(ki,nrow(ad3),k),i]
  points(tt,yi,type = 'b',col=rainbow(ncol(ad3))[i])
}
#text.legend=c("lambda=0","lambda=2","lambda=5","lambda=8","lambda=11","lambda=14","lambda=17")
legend("bottomright",legend=c("True",lams),col=c("black",rainbow(ncol(ad3))),ncol=2,cex=0.8,pch=16,lwd=2)
n1<-
ergm.bridge.llr(lazega.ergm,from=f2,to=f3,llronly = TRUE)
